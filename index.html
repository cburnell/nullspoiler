<!doctype html>
<html>
	<head>
		<script src='/socket.io/socket.io.js'></script>
		<script>
var socket = io();

socket.on('welcome', function(data) {

	// Respond with a message including this clients' id sent from the server
	socket.emit('i am client', {data: 'foo!', id: data.id});
});
socket.on('error', console.error.bind(console));
socket.on('message', console.log.bind(console));

		</script>
	</head>
	<body>
		<div id = "running_log">maybe put an explination here?.</div>
		<!-- Display the countdown timer in an element -->
		<ul id="messages"></ul>
		<div id="time"></div>
		<input id="spoiler" autocomplete="off"/>
		<button	onClick="sendData()">Add Comment</button>
		<button onClick="submitSpoilers()"> Submit spoilers </button>
		<script> 
// Set the date we're counting down to
var countDownDate = new Date().getTime();
var dictionary_of_spoilers = {} 
var distance;
// Update the count down every 1 second
var x = setInterval(function() {
	// Get todays date and time
	var now = new Date().getTime();
	// Find the distance between now an the count down date
	distance = Math.floor((now - countDownDate)/1000);
	// Time calculations for days, hours, minutes and seconds
	var hours = Math.floor((distance % (60 * 60 * 24)) / (60 * 60));
	var minutes = Math.floor((distance % (60 * 60)) / 60);
	var seconds = Math.floor((distance % 60));
	// Display the result in the element with id="time"
	document.getElementById("time").innerHTML = hours + "h "
		+ minutes + "m " + seconds + "s ";
}, 1000);
document.getElementById("spoiler").addEventListener("keydown", function(e) {
	if (e.keyCode === 13) {
		sendData(e);
	}
});
function sendData(e) {
	var spoiler =
		document.getElementById("spoiler").value.trim();
	if (spoiler === "") return false;

	var socket = io();
	socket.emit('rec-final', spoiler);
	console.log(distance + ":" + spoiler);
	if (dictionary_of_spoilers[distance] ==
		undefined) {
		dictionary_of_spoilers[distance]
			= spoiler; 
	}
	else {
		dictionary_of_spoilers[distance]
			+= "\n<br />" + spoiler; 
	}
	document.getElementById("spoiler").value =
		"";
	// Rewrite what messages have been sent with time.
		var new_messages = ""
	for (var key in dictionary_of_spoilers) {
		var hours = Math.floor((key %
			(60 * 60 * 24)) / (60 *
				60));
		var minutes = Math.floor((key
			% (60 * 60)) / 60);
		var seconds = Math.floor((key
			% 60));
		new_messages += hours + ":" +
			minutes + ":" + seconds + " | " +
			dictionary_of_spoilers[key] + "<br />";
	}
	document.getElementById("messages").innerHTML
		= new_messages;
	document.getElementById("spoiler").focus();
	document.getElementById("spoiler").select();
	return false;
}

function submitSpoilers(e) {
	var socket = io();
	socket.emit('submit spoiler', JSON.stringify(dictionary_of_spoilers));
}
		</script>
	</body>
</html>
